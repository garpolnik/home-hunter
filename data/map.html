<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Home Deal Finder - Live Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin="anonymous" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin="anonymous"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
  #map { height: 100vh; width: 100%; }
  .header-bar {
    position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
    background: rgba(26, 54, 93, 0.95); color: white;
    padding: 10px 20px; display: flex; align-items: center;
    justify-content: space-between; backdrop-filter: blur(4px);
  }
  .header-bar h1 { font-size: 18px; font-weight: 600; }
  .header-bar .stats { font-size: 13px; opacity: 0.85; }
  .legend {
    position: fixed; bottom: 30px; right: 10px; z-index: 1000;
    background: white; padding: 12px 16px; border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2); font-size: 13px;
  }
  .legend-item { display: flex; align-items: center; margin: 4px 0; }
  .legend-dot { width: 14px; height: 14px; border-radius: 50%; margin-right: 8px; border: 2px solid rgba(0,0,0,0.2); }
  .filter-bar {
    position: fixed; top: 46px; left: 0; right: 0; z-index: 999;
    background: rgba(255,255,255,0.95); padding: 8px 20px;
    display: flex; gap: 12px; align-items: center; flex-wrap: wrap;
    border-bottom: 1px solid #e2e8f0; backdrop-filter: blur(4px);
    font-size: 13px;
  }
  .filter-bar label { font-weight: 500; color: #4a5568; }
  .filter-bar input, .filter-bar select {
    padding: 4px 8px; border: 1px solid #cbd5e0; border-radius: 4px;
    font-size: 13px;
  }
  .popup-content { min-width: 250px; }
  .popup-content h3 { font-size: 15px; margin-bottom: 4px; color: #2d3748; }
  .popup-content .price { font-size: 20px; font-weight: 700; color: #2d3748; margin: 4px 0; }
  .popup-content .details { font-size: 13px; color: #4a5568; line-height: 1.6; }
  .popup-content .score-badge {
    display: inline-block; padding: 2px 10px; border-radius: 10px;
    color: white; font-weight: 700; font-size: 14px; margin: 4px 0;
  }
  .popup-content .links { margin-top: 8px; }
  .popup-content .links a { font-size: 12px; color: #3182ce; margin-right: 10px; text-decoration: none; }
  .popup-content .links a:hover { text-decoration: underline; }
</style>
</head>
<body>
<div class="header-bar">
  <h1>Home Deal Finder - Live Map</h1>
  <span class="stats" id="statsText"></span>
</div>
<div class="filter-bar">
  <label>Min Score:</label>
  <input type="range" id="minScore" min="0" max="100" value="0" oninput="filterListings()">
  <span id="minScoreVal">0</span>
  <label>Max Price:</label>
  <input type="number" id="maxPrice" placeholder="Any" step="10000" oninput="filterListings()">
  <label>Min Beds:</label>
  <select id="minBeds" onchange="filterListings()">
    <option value="0">Any</option><option value="1">1+</option><option value="2">2+</option>
    <option value="3">3+</option><option value="4">4+</option><option value="5">5+</option>
  </select>
  <label>Type:</label>
  <select id="propType" onchange="filterListings()">
    <option value="">All</option><option value="single_family">Single Family</option>
    <option value="townhouse">Townhouse</option><option value="condo">Condo</option>
  </select>
</div>
<div class="legend">
  <div class="legend-item"><div class="legend-dot" style="background:#38a169;"></div> Great Deal (70+)</div>
  <div class="legend-item"><div class="legend-dot" style="background:#d69e2e;"></div> Good Deal (50-69)</div>
  <div class="legend-item"><div class="legend-dot" style="background:#e53e3e;"></div> Below Average (&lt;50)</div>
  <div class="legend-item"><div class="legend-dot" style="background:#a0aec0;"></div> Not Scored</div>
</div>
<div id="map"></div>
<script>
const LISTINGS = [{"address": "406 Burnt Mill Rd", "city": "Cherry Hill", "state": "NJ", "zip_code": "08003", "latitude": 39.86402, "longitude": -75.007552, "price": 419000, "property_type": "single_family", "bedrooms": 4, "bathrooms": 2.0, "sqft": 1352, "lot_sqft": 7405, "year_built": null, "days_on_market": 3, "hoa_monthly": null, "deal_score": 37.3, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/406-Burnt-Mill-Rd_Cherry-Hill_NJ_08003_M67048-93121"}}, {"address": "305 Oak Ave", "city": "Cherry Hill", "state": "NJ", "zip_code": "08002", "latitude": 39.939051, "longitude": -75.007932, "price": 285000, "property_type": "single_family", "bedrooms": 4, "bathrooms": 1.0, "sqft": 1139, "lot_sqft": 22651, "year_built": null, "days_on_market": 3, "hoa_monthly": null, "deal_score": 45.9, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/305-Oak-Ave_Cherry-Hill_NJ_08002_M52036-30439"}}, {"address": "25 Appley Ct", "city": "Cherry Hill", "state": "NJ", "zip_code": "08002", "latitude": 39.937662, "longitude": -75.013962, "price": 299999, "property_type": null, "bedrooms": 2, "bathrooms": 2.0, "sqft": 1183, "lot_sqft": 1307, "year_built": null, "days_on_market": 3, "hoa_monthly": null, "deal_score": 40.7, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/25-Appley-Ct_Cherry-Hill_NJ_08002_M64469-30196"}}, {"address": "37 James Run", "city": "Cherry Hill", "state": "NJ", "zip_code": "08002", "latitude": 39.937786, "longitude": -75.015885, "price": 325000, "property_type": null, "bedrooms": 3, "bathrooms": 3.0, "sqft": 1160, "lot_sqft": null, "year_built": null, "days_on_market": 3, "hoa_monthly": null, "deal_score": 41.8, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/37-James-Run_Cherry-Hill_NJ_08002_M61540-00996"}}, {"address": "610 Kenilworth Ave", "city": "Cherry Hill", "state": "NJ", "zip_code": "08002", "latitude": 39.939055, "longitude": -75.041714, "price": 389000, "property_type": "single_family", "bedrooms": 3, "bathrooms": 3.0, "sqft": 1325, "lot_sqft": null, "year_built": null, "days_on_market": 6, "hoa_monthly": null, "deal_score": 40.5, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/610-Kenilworth-Ave_Cherry-Hill_NJ_08002_M69322-00849"}}, {"address": "3005 Garfield Ave", "city": "Cherry Hill", "state": "NJ", "zip_code": "08002", "latitude": 39.938718, "longitude": -74.999453, "price": 465000, "property_type": "single_family", "bedrooms": 3, "bathrooms": 2.0, "sqft": 1604, "lot_sqft": 16553, "year_built": null, "days_on_market": 9, "hoa_monthly": null, "deal_score": 41.0, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/3005-Garfield-Ave_Cherry-Hill_NJ_08002_M69003-21959"}}, {"address": "136 Valley Run Dr", "city": "Cherry Hill", "state": "NJ", "zip_code": "08002", "latitude": 39.917613, "longitude": -75.011224, "price": 498000, "property_type": "single_family", "bedrooms": 3, "bathrooms": 2.0, "sqft": 1736, "lot_sqft": 6534, "year_built": null, "days_on_market": 14, "hoa_monthly": null, "deal_score": 39.5, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/136-Valley-Run-Dr_Cherry-Hill_NJ_08002_M60721-23716"}}, {"address": "300 Hinchman Ave", "city": "Cherry Hill", "state": "NJ", "zip_code": "08002", "latitude": 39.945787, "longitude": -75.039955, "price": 429000, "property_type": "single_family", "bedrooms": 3, "bathrooms": 2.0, "sqft": 1400, "lot_sqft": null, "year_built": null, "days_on_market": 15, "hoa_monthly": null, "deal_score": 39.5, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/300-Hinchman-Ave_Cherry-Hill_NJ_08002_M59288-77284"}}, {"address": "623 Kenilworth Ave", "city": "Cherry Hill", "state": "NJ", "zip_code": "08002", "latitude": 39.938153, "longitude": -75.041214, "price": 445000, "property_type": "single_family", "bedrooms": 4, "bathrooms": 2.0, "sqft": 2092, "lot_sqft": 20473, "year_built": null, "days_on_market": 28, "hoa_monthly": null, "deal_score": 49.2, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/623-Kenilworth-Ave_Cherry-Hill_NJ_08002_M58062-35068"}}, {"address": "904 Mercer St", "city": "Cherry Hill", "state": "NJ", "zip_code": "08002", "latitude": 39.925171, "longitude": -75.030815, "price": 474500, "property_type": "single_family", "bedrooms": 4, "bathrooms": 3.0, "sqft": 2136, "lot_sqft": 8712, "year_built": null, "days_on_market": 36, "hoa_monthly": null, "deal_score": 46.9, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/904-Mercer-St_Cherry-Hill_NJ_08002_M61832-14377"}}, {"address": "169 Cherry Tree Ln", "city": "Cherry Hill", "state": "NJ", "zip_code": "08002", "latitude": 39.938779, "longitude": -74.99176, "price": 495000, "property_type": "single_family", "bedrooms": 3, "bathrooms": 3.0, "sqft": 1829, "lot_sqft": 12632, "year_built": null, "days_on_market": 38, "hoa_monthly": null, "deal_score": 43.8, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/169-Cherry-Tree-Ln_Cherry-Hill_NJ_08002_M59946-59193"}}, {"address": "521 Woodland Ave", "city": "Cherry Hill", "state": "NJ", "zip_code": "08002", "latitude": 39.934784, "longitude": -75.034716, "price": 425000, "property_type": "single_family", "bedrooms": 4, "bathrooms": 3.0, "sqft": 2000, "lot_sqft": 13504, "year_built": null, "days_on_market": 63, "hoa_monthly": null, "deal_score": 50.7, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/521-Woodland-Ave_Cherry-Hill_NJ_08002_M69229-58895"}}, {"address": "1 Webster Ave", "city": "Cherry Hill", "state": "NJ", "zip_code": "08002", "latitude": 39.916642, "longitude": -75.027196, "price": 419000, "property_type": "single_family", "bedrooms": 3, "bathrooms": 2.0, "sqft": 1341, "lot_sqft": 9148, "year_built": null, "days_on_market": 64, "hoa_monthly": null, "deal_score": 41.7, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/1-Webster-Ave_Cherry-Hill_NJ_08002_M53070-46395"}}, {"address": "202 Cranford Rd", "city": "Cherry Hill", "state": "NJ", "zip_code": "08003", "latitude": 39.873762, "longitude": -75.001481, "price": 535000, "property_type": "single_family", "bedrooms": 4, "bathrooms": 3.0, "sqft": 2188, "lot_sqft": 9583, "year_built": null, "days_on_market": 1, "hoa_monthly": null, "deal_score": 58.0, "walk_score": null, "flood_risk_rating": "minimal", "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/202-Cranford-Rd_Cherry-Hill_NJ_08003_M52880-62806"}}, {"address": "1113 Crane Dr", "city": "Cherry Hill", "state": "NJ", "zip_code": "08003", "latitude": 39.877863, "longitude": -74.98186, "price": 485000, "property_type": "single_family", "bedrooms": 4, "bathrooms": 3.0, "sqft": 2212, "lot_sqft": 11326, "year_built": null, "days_on_market": 16, "hoa_monthly": null, "deal_score": 46.2, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/1113-Crane-Dr_Cherry-Hill_NJ_08003_M52272-48640"}}, {"address": "28 Forest Hill Dr", "city": "Cherry Hill", "state": "NJ", "zip_code": "08003", "latitude": 39.911941, "longitude": -74.964666, "price": 530999, "property_type": "single_family", "bedrooms": 3, "bathrooms": 2.0, "sqft": 2082, "lot_sqft": 10890, "year_built": null, "days_on_market": 22, "hoa_monthly": null, "deal_score": 42.9, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/28-Forest-Hill-Dr_Cherry-Hill_NJ_08003_M54425-52883"}}, {"address": "195 Eleanor Ter", "city": "Cherry Hill", "state": "NJ", "zip_code": "08003", "latitude": 39.864497, "longitude": -75.01174, "price": 357000, "property_type": "single_family", "bedrooms": 3, "bathrooms": 1.0, "sqft": 1302, "lot_sqft": 7841, "year_built": null, "days_on_market": 27, "hoa_monthly": null, "deal_score": 41.2, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/195-Eleanor-Ter_Cherry-Hill_NJ_08003_M57563-09374"}}, {"address": "1535 Pleasant Dr", "city": "Cherry Hill", "state": "NJ", "zip_code": "08003", "latitude": 39.87465, "longitude": -75.002098, "price": 544000, "property_type": "single_family", "bedrooms": 4, "bathrooms": 2.0, "sqft": 2100, "lot_sqft": 9583, "year_built": null, "days_on_market": 44, "hoa_monthly": null, "deal_score": 44.0, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/1535-Pleasant-Dr_Cherry-Hill_NJ_08003_M52231-45534"}}, {"address": "101 Railroad Blvd", "city": "Cherry Hill", "state": "NJ", "zip_code": "08003", "latitude": 39.860704, "longitude": -75.008818, "price": 385000, "property_type": "single_family", "bedrooms": 3, "bathrooms": 2.0, "sqft": 1374, "lot_sqft": 6098, "year_built": null, "days_on_market": 74, "hoa_monthly": null, "deal_score": 68.0, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/101-Railroad-Blvd_Cherry-Hill_NJ_08003_M58850-29791"}}, {"address": "328 Browning Ln", "city": "Cherry Hill", "state": "NJ", "zip_code": "08003", "latitude": 39.877695, "longitude": -74.998087, "price": 485000, "property_type": "single_family", "bedrooms": 3, "bathrooms": 2.0, "sqft": 1692, "lot_sqft": 9583, "year_built": null, "days_on_market": 107, "hoa_monthly": null, "deal_score": 45.9, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/328-Browning-Ln_Cherry-Hill_NJ_08003_M58159-77223"}}, {"address": "125 W Cottage Ave", "city": "Haddonfield", "state": "NJ", "zip_code": "08033", "latitude": 39.891817, "longitude": -75.036879, "price": 416000, "property_type": null, "bedrooms": 3, "bathrooms": 2.0, "sqft": 1778, "lot_sqft": 4792, "year_built": null, "days_on_market": 23, "hoa_monthly": null, "deal_score": 47.8, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/125-W-Cottage-Ave_Haddonfield_NJ_08033_M69210-59555"}}, {"address": "300 Copley Rd", "city": "Haddonfield", "state": "NJ", "zip_code": "08033", "latitude": 39.875375, "longitude": -75.043245, "price": 549000, "property_type": "single_family", "bedrooms": 4, "bathrooms": 2.0, "sqft": 1845, "lot_sqft": 50965, "year_built": null, "days_on_market": 24, "hoa_monthly": null, "deal_score": 46.8, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/300-Copley-Rd_Haddonfield_NJ_08033_M93268-66405"}}, {"address": "222 Bradley Ave", "city": "Haddonfield", "state": "NJ", "zip_code": "08033", "latitude": 39.907314, "longitude": -75.056065, "price": 530000, "property_type": "single_family", "bedrooms": 3, "bathrooms": 2.0, "sqft": 1392, "lot_sqft": null, "year_built": null, "days_on_market": 38, "hoa_monthly": null, "deal_score": 39.9, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/222-Bradley-Ave_Haddonfield_NJ_08033_M55019-76317"}}, {"address": "501 Rhoads Ave", "city": "Haddonfield", "state": "NJ", "zip_code": "08033", "latitude": 39.902038, "longitude": -75.054153, "price": 525000, "property_type": "single_family", "bedrooms": 3, "bathrooms": 2.0, "sqft": 1570, "lot_sqft": 4792, "year_built": null, "days_on_market": 115, "hoa_monthly": null, "deal_score": 47.3, "walk_score": null, "flood_risk_rating": null, "source_urls": {"realtor": "https://www.realtor.com/realestateandhomes-detail/501-Rhoads-Ave_Haddonfield_NJ_08033_M60014-85158"}}];

const map = L.map('map', { zoomControl: true }).setView([39.85, -75.0], 10);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors',
  maxZoom: 19,
}).addTo(map);

// Offset map down to account for header + filter bar
map.getContainer().style.marginTop = '90px';
map.getContainer().style.height = 'calc(100vh - 90px)';
map.invalidateSize();

let markers = [];
let markerLayer = L.layerGroup().addTo(map);

function getColor(score) {
  if (score === null || score === undefined) return '#a0aec0';
  if (score >= 70) return '#38a169';
  if (score >= 50) return '#d69e2e';
  return '#e53e3e';
}

function createMarker(listing) {
  const color = getColor(listing.deal_score);
  const marker = L.circleMarker([listing.latitude, listing.longitude], {
    radius: 8, fillColor: color, color: '#fff', weight: 2,
    opacity: 1, fillOpacity: 0.85,
  });

  const scoreBg = listing.deal_score !== null
    ? `background:${color}` : 'background:#a0aec0';
  const scoreText = listing.deal_score !== null
    ? listing.deal_score.toFixed(1) : 'N/A';

  let linksHtml = '';
  if (listing.source_urls) {
    for (const [src, url] of Object.entries(listing.source_urls)) {
      if (url) linksHtml += `<a href="${url}" target="_blank">${src.charAt(0).toUpperCase() + src.slice(1)}</a>`;
    }
  }

  const fmt = (n) => n ? n.toLocaleString() : 'N/A';

  marker.bindPopup(`
    <div class="popup-content">
      <h3>${listing.address}</h3>
      <div>${listing.city}, ${listing.state} ${listing.zip_code}</div>
      <div class="price">$${listing.price.toLocaleString()}</div>
      <span class="score-badge" style="${scoreBg}">Score: ${scoreText}</span>
      <div class="details">
        ${listing.bedrooms || '?'} bed &bull; ${listing.bathrooms || '?'} bath &bull; ${fmt(listing.sqft)} sqft<br>
        ${listing.lot_sqft ? fmt(listing.lot_sqft) + ' lot sqft &bull; ' : ''}
        ${listing.year_built ? 'Built ' + listing.year_built + ' &bull; ' : ''}
        ${listing.days_on_market !== null ? listing.days_on_market + ' DOM' : ''}<br>
        ${listing.hoa_monthly ? '$' + listing.hoa_monthly + '/mo HOA &bull; ' : ''}
        ${listing.walk_score ? 'Walk: ' + listing.walk_score + ' &bull; ' : ''}
        ${listing.flood_risk_rating ? 'Flood: ' + listing.flood_risk_rating : ''}
      </div>
      <div class="links">${linksHtml}</div>
    </div>
  `);

  marker._listingData = listing;
  return marker;
}

function filterListings() {
  const minScore = parseInt(document.getElementById('minScore').value);
  document.getElementById('minScoreVal').textContent = minScore;
  const maxPrice = parseInt(document.getElementById('maxPrice').value) || Infinity;
  const minBeds = parseInt(document.getElementById('minBeds').value);
  const propType = document.getElementById('propType').value;

  markerLayer.clearLayers();
  let shown = 0;
  markers.forEach(m => {
    const d = m._listingData;
    const score = d.deal_score !== null ? d.deal_score : 0;
    if (score >= minScore && d.price <= maxPrice
        && (d.bedrooms || 0) >= minBeds
        && (!propType || d.property_type === propType)) {
      markerLayer.addLayer(m);
      shown++;
    }
  });
  document.getElementById('statsText').textContent =
    `Showing ${shown} of ${markers.length} listings`;
}

// Initialize markers
LISTINGS.forEach(l => {
  if (l.latitude && l.longitude) {
    markers.push(createMarker(l));
  }
});
markers.forEach(m => markerLayer.addLayer(m));

// Fit bounds to all markers
if (markers.length > 0) {
  const group = L.featureGroup(markers);
  map.fitBounds(group.getBounds().pad(0.1));
}

document.getElementById('statsText').textContent =
  `Showing ${markers.length} of ${markers.length} listings`;
</script>
</body>
</html>